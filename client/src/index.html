<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="format-detection" content="telephone=no" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="MobileOptimized" content="176" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="robots" content="noindex, nofollow" />
  <title>Fashion Store</title>
  
  <!-- Загружаем скрипт Telegram WebApp первым и синхронно -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  
  <script>
    // Функция для проверки готовности WebApp
    function initTelegramWebApp() {
      console.log('Проверка Telegram WebApp...');
      
      if (window.Telegram && window.Telegram.WebApp) {
        try {
          console.log('WebApp найден, вызываем ready()');
          window.Telegram.WebApp.ready();
          console.log('WebApp готов');
          
          // Применяем тему
          const webApp = window.Telegram.WebApp;
          if (webApp.themeParams) {
            Object.entries(webApp.themeParams).forEach(([key, value]) => {
              if (value) {
                document.documentElement.style.setProperty(
                  `--tg-theme-${key.replace(/_/g, '-')}`,
                  value
                );
              }
            });
          }
          
          // Устанавливаем высоту viewport
          if (webApp.viewportHeight) {
            document.documentElement.style.setProperty(
              '--tg-viewport-height',
              `${webApp.viewportHeight}px`
            );
          }
          
          // Расширяем окно
          if (typeof webApp.expand === 'function') {
            webApp.expand();
          }
          
          // Отправляем событие в React
          window.dispatchEvent(new Event('tgWebAppReady'));
          return true;
        } catch (error) {
          console.error('Ошибка при инициализации WebApp:', error);
          return false;
        }
      } else {
        console.log('WebApp не найден');
        return false;
      }
    }

    // Пытаемся инициализировать сразу
    if (!initTelegramWebApp()) {
      // Если не удалось, пробуем еще раз после полной загрузки страницы
      window.addEventListener('load', () => {
        console.log('Страница загружена, повторная попытка инициализации');
        initTelegramWebApp();
      });
    }
  </script>
</head>
<body>
  <div id="root"></div>
  <script type="module" src="/src/main.tsx"></script>
</body>
</html> 